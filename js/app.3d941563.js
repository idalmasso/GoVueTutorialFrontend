(function(e){function t(t){for(var r,u,a=t[0],i=t[1],c=t[2],l=0,p=[];l<a.length;l++)u=a[l],Object.prototype.hasOwnProperty.call(o,u)&&o[u]&&p.push(o[u][0]),o[u]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);d&&d(t);while(p.length)p.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==o[i]&&(r=!1)}r&&(s.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},o={app:0},s=[];function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var d=i;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"1e02":function(e,t,n){"use strict";n("7e55")},"3eb1":function(e,t,n){"use strict";n("5ab7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("the-application-bar"),n("router-view",{staticClass:"content"})],1)},s=[],u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-bar"},[n("div",{staticClass:"left-links"},e._l(e.activeLinks,(function(t){return n("router-link",{key:t.name,staticClass:"app-bar-item",attrs:{to:t.to}},[e._v(" "+e._s(t.name)+" ")])})),1),n("div",{staticClass:"right-links "},[e.loggedIn?e._e():n("router-link",{staticClass:"app-bar-item",attrs:{href:"#",to:{name:"Login"}},on:{click:function(e){e.preventDefault()}}},[e._v("LOGIN")]),e.loggedIn?n("a",{staticClass:"app-bar-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.logoutButtonClicked(t)}}},[e._v("LOGOUT")]):e._e()],1)])},a=[],i=(n("4de4"),n("5530")),c=n("2f62"),d={methods:Object(i["a"])(Object(i["a"])({},Object(c["b"])({login:"auth/login",logout:"auth/logout"})),{},{logoutButtonClicked:function(){this.logout()}}),computed:Object(i["a"])(Object(i["a"])({},Object(c["c"])({loggedIn:"auth/isLoggedIn"})),{},{links:function(){return[{visibleIfLoggedOut:!0,name:"Posts",to:{name:"Posts"}},{visibleIfLoggedOut:!1,name:"User",to:{name:"User",params:{userid:this.currentUser}}}]},currentUser:function(){var e=this.$store.getters["auth/currentUser"];return e?e.username:""},activeLinks:function(){var e=this;return this.links.filter((function(t){return t.visibleIfLoggedOut||e.loggedIn}))}})},l=d,p=(n("7407"),n("2877")),f=Object(p["a"])(l,u,a,!1,null,"c1f138e0",null),h=f.exports,m={components:{TheApplicationBar:h},mounted:function(){this.$store.dispatch("auth/loadUser")}},g=m,b=(n("034f"),Object(p["a"])(g,o,s,!1,null,null,null)),v=b.exports,w=n("9483");Object(w["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var _=n("8c4f"),k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"posts"},[n("h1",[e._v("All Posts")]),e.loggedIn?n("add-text-form",{attrs:{textRequest:"Add Post",showLabel:!0},on:{"text-added":e.addPost}}):e._e(),n("post-list",{attrs:{posts:e.posts,title:""}})],1)},O=[],x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",[e._v(e._s(e.title))]),e.showPosts?n("div",{staticClass:"post-list"},e._l(e.posts,(function(e){return n("single-post",{key:e.id,attrs:{post:e}})})),1):e._e()])},T=[],j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-card",{attrs:{expandable:e.post.comments&&e.post.comments.length>0},scopedSlots:e._u([{key:"header",fn:function(){return[n("h3",[n("router-link",{attrs:{to:e.linkUser(e.post.username)}},[e._v(e._s(e.postTitle(e.post)))])],1),e.loggedIn&&e.currentUser.username===e.post.username?n("button",{staticClass:"delete-button",on:{click:function(t){return t.preventDefault(),e.deletePost(t)}}},[e._v(" Delete ")]):e._e()]},proxy:!0},{key:"footer",fn:function(){return e._l(e.post.comments,(function(t){return n("base-card",{key:t.id,attrs:{expandable:!1},scopedSlots:e._u([{key:"header",fn:function(){return[n("h3",[n("router-link",{attrs:{to:e.linkUser(t.username)}},[e._v(e._s(e.postTitle(t)))])],1)]},proxy:!0}],null,!0)},[e._v(" "+e._s(t.post)+" ")])}))},proxy:!0},e.loggedIn?{key:"actions",fn:function(){return[n("add-text-form",{attrs:{textRequest:"Add comment",showLabel:!1},on:{"text-added":function(t){return e.addComment(t,e.post)}}})]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(e.post.post)+" ")])},P=[],S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"box-div"},[e.$slots.header?n("header",[e._t("header")],2):e._e(),e._t("default"),e.$slots.footer&&e.expandable?n("footer",[n("a",{staticClass:"footer-elements",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleDetails(t)}}},[e._v(e._s(e.messageValue))]),e.expanded?e._t("footer"):e._e()],2):e._e(),n("div",{staticClass:"actions"},[e._t("actions")],2)],2)},y=[],A={props:{expandable:{type:Boolean,default:!1}},data:function(){return{expanded:!1}},computed:{messageValue:function(){return this.expanded?"Hide":"Show"}},methods:{toggleDetails:function(){this.expanded=!this.expanded}}},U=A,I=(n("1e02"),Object(p["a"])(U,S,y,!1,null,"54b34514",null)),E=I.exports,L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{on:{submit:function(t){return t.preventDefault(),e.submitted(t)}}},[e.showLabel?n("label",{attrs:{for:"text"+this._uid}},[e._v(e._s(e.textRequest))]):e._e(),n("input",{directives:[{name:"model",rawName:"v-model",value:e.textValue,expression:"textValue"}],attrs:{id:"text"+this._uid,type:"text",placeholder:e.textRequest},domProps:{value:e.textValue},on:{input:function(t){t.target.composing||(e.textValue=t.target.value)}}}),n("button",{attrs:{type:"submit"}},[e._v("submit")])])},R=[],C={data:function(){return{textValue:""}},props:{textRequest:{type:String,default:""},showLabel:{type:Boolean,default:!1}},methods:{submitted:function(){this.$emit("text-added",this.textValue),this.textValue=""}},emits:["text-added"]},D=C,N=(n("9c32"),Object(p["a"])(D,L,R,!1,null,"fb917da2",null)),$=N.exports,z={components:{BaseCard:E,AddTextForm:$},props:["post"],computed:Object(i["a"])({},Object(c["c"])({loggedIn:"auth/isLoggedIn",currentUser:"auth/currentUser"})),methods:{postTitle:function(e){return e.username+"@"+e.date},linkUser:function(e){return{name:"User",params:{userid:e}}},addComment:function(e,t){this.$store.dispatch("posts/addComment",{postId:t.id,comment:{username:this.currentUser.username,post:e}})},deletePost:function(){this.$store.dispatch("posts/deletePost",{post:this.post})}}},B=z,G=(n("df6b"),Object(p["a"])(B,j,P,!1,null,"236e53ee",null)),H=G.exports,V={components:{SinglePost:H},props:["posts","title"],computed:{showPosts:function(){return this.posts&&this.posts.length>0}}},M=V,q=Object(p["a"])(M,x,T,!1,null,null,null),J=q.exports,F={name:"Posts",components:{PostList:J,AddTextForm:$},computed:Object(i["a"])(Object(i["a"])({},Object(c["c"])({loggedIn:"auth/isLoggedIn"})),{},{posts:function(){return this.$store.getters["posts/allPosts"]}}),methods:{addPost:function(e){this.$store.dispatch("posts/addPost",{username:this.$store.getters["auth/currentUser"].username,post:e})}},mounted:function(){this.$store.dispatch("posts/getAllPosts")}},Z=F,K=Object(p["a"])(Z,k,O,!1,null,null,null),Q=K.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("base-card",[n("form",{on:{submit:function(e){e.preventDefault()}}},[n("label",{attrs:{for:"username"}},[e._v("Username")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{id:"username",type:"text"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),n("label",{attrs:{for:"password"}},[e._v("Password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{id:"password",type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),n("button",{on:{click:e.loginButtonClicked}},[e._v(e._s(e.buttonString))]),e.error?n("p",[e._v(e._s(e.error))]):e._e(),n("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleLogin(t)}}},[e._v(e._s(e.textLoginString))])])])],1)},X=[],Y={components:{BaseCard:E},data:function(){return{loginSelected:!0,username:"",password:"",error:""}},methods:Object(i["a"])(Object(i["a"])({},Object(c["b"])({login:"auth/login",signup:"auth/signup"})),{},{loginButtonClicked:function(){var e=this;this.loginSelected?this.login({username:this.username,password:this.password}).then((function(){e.$router.push({name:"Posts"})})).catch((function(t){e.error=t})):this.signup({username:this.username,password:this.password}).then((function(){e.$router.push({name:"Posts"})})).catch((function(t){e.error=t}))},toggleLogin:function(){this.loginSelected=!this.loginSelected}}),computed:{buttonString:function(){return this.loginSelected?"LOGIN":"SIGNUP"},textLoginString:function(){return this.loginSelected?"Signup instead":"Login instead"}}},ee=Y,te=(n("3eb1"),Object(p["a"])(ee,W,X,!1,null,"2975b3e0",null)),ne=te.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("h1",[e._v("User: "+e._s(e.user.username))]),n("h3",[e._v("Bio")]),n("p",[e._v(e._s(e.user.description))]),this.userid==e.currentUsername?n("add-text-form",{attrs:{textRequest:"Change description",showLabel:!1},on:{"text-added":e.updateDescription}}):e._e(),n("post-list",{attrs:{posts:e.userPosts,title:"Last Posts"}})],1)},oe=[],se={components:{PostList:J,AddTextForm:$},props:{userid:{type:String,default:""}},computed:{userPosts:function(){return this.$store.getters["posts/userPosts"](this.userid)},user:function(){return this.$store.getters["users/getUser"](this.userid)},currentUsername:function(){return this.$store.getters["auth/currentUser"].username}},methods:{updateDescription:function(e){this.$store.dispatch("users/updateDescription",{username:this.userid,description:e})}},mounted:function(){this.$store.dispatch("users/addUser",{username:this.userid})}},ue=se,ae=Object(p["a"])(ue,re,oe,!1,null,null,null),ie=ae.exports,ce=(n("7db0"),n("fb6a"),n("d3b7"),n("96cf"),n("1da1"));var de,le={namespaced:!0,state:{posts:[]},mutations:{SET_ALL_POSTS:function(e,t){e.posts=t},ADD_POST:function(e,t){e.posts.push(t)},DELETE_POST:function(e,t){e.posts=e.posts.filter((function(e){return e.id!=t}))},SET_POST_COMMENTS:function(e,t){var n=t.postId,r=t.post,o=e.posts.find((function(e){return e.id==n}));o.comments=r.comments}},actions:{addPost:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.dispatch("auth/updateAuthorizationIfNeeded",{},{root:!0}).then((function(){fetch("http://localhost:3000/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:e.rootGetters["auth/getTokenHeader"]},body:JSON.stringify(t)}).then((function(e){if(!e.ok)throw Error(e.body);return e.json()})).then((function(t){e.commit("ADD_POST",t)})).catch((function(e){console.log(e)}))}));case 1:case"end":return n.stop()}}),n)})))()},deletePost:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.post,e.dispatch("auth/updateAuthorizationIfNeeded",{},{root:!0}).then((function(){fetch("/api/posts/"+r.id,{method:"DELETE",headers:{Authorization:e.rootGetters["auth/getTokenHeader"]}}).then((function(t){if(!t.ok)throw Error(t);e.commit("DELETE_POST",r.id)})).catch((function(e){console.log(e)}))}));case 2:case"end":return n.stop()}}),n)})))()},addComment:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.postId,o=t.comment,e.dispatch("auth/updateAuthorizationIfNeeded",{},{root:!0}).then((function(){fetch("/api/posts/"+r+"/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:e.rootGetters["auth/getTokenHeader"]},body:JSON.stringify(o)}).then((function(e){if(e.ok)return e.json();throw Error(e.body)})).then((function(t){e.commit("SET_POST_COMMENTS",{postId:r,post:t})})).catch((function(e){console.log(e)}))}));case 2:case"end":return n.stop()}}),n)})))()},getAllPosts:function(e){return Object(ce["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:fetch("/api/posts").then((function(e){if(e.ok)return e.json();throw Error(e.body)})).then((function(t){e.commit("SET_ALL_POSTS",t)})).catch((function(e){console.log(e)}));case 1:case"end":return t.stop()}}),t)})))()}},getters:{allPosts:function(e){return e.posts},userPosts:function(e){return function(t){return e.posts.filter((function(e){return e.username===t}))}}}},pe=(n("a4d3"),n("e01a"),n("c975"),n("45fc"),n("a434"),{namespaced:!0,state:{loadedUsers:[]},mutations:{ADD_USER:function(e,t){e.loadedUsers.some((function(e){return e.username==t.username}))&&e.loadedUsers.splice(e.loadedUsers.indexOf((function(e){return e.username==t.username})),1),e.loadedUsers.push(t)}},actions:{addUser:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.username,n.abrupt("return",fetch("/api/users/"+r,{headers:{Authorization:e.rootGetters["auth/getTokenHeader"]}}).then((function(t){if(!t.ok)throw 401==t.status&&e.dispatch("auth/logout",{},{root:!0}),new Error("Cannot get user");return t.json()})).then((function(t){e.commit("ADD_USER",t)})).catch((function(e){throw console.log(e),e})));case 2:case"end":return n.stop()}}),n)})))()},updateDescription:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.username,o=t.description,e.dispatch("auth/updateAuthorizationIfNeeded",{},{root:!0}).then((function(){return fetch("/api/users/"+r,{method:"PATCH",headers:{Authorization:e.rootGetters["auth/getTokenHeader"],"Content-Type":"application/json"},body:JSON.stringify({username:r,description:o})}).then((function(t){if(!t.ok)throw 401==t.status&&e.dispatch("auth/logout",{},{root:!0}),new Error("Cannot update");return t.json()})).then((function(t){e.commit("ADD_USER",t)})).catch((function(e){throw console.log(e),e}))}));case 2:case"end":return n.stop()}}),n)})))()}},getters:{getUser:function(e){return function(t){return e.loadedUsers.some((function(e){return e.username==t}))?e.loadedUsers.find((function(e){return e.username==t})):{}}}}}),fe=n("1232"),he="authDB",me=1,ge={getDb:function(){return Object(ce["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){if(de)return e(de);var n=window.indexedDB.open(he,me);n.onerror=function(e){t("Error")},n.onsuccess=function(t){de=t.target.result,e(de)},n.onupgradeneeded=function(e){console.log("onupgradeneeded called");var t=e.target.result;t.createObjectStore("userAuth",{autoIncrement:!0,keyPath:"username"})}})));case 1:case"end":return e.stop()}}),e)})))()},addUser:function(e){var t=this;return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.getDb();case 2:return r=n.sent,n.abrupt("return",new Promise((function(t){var n=r.transaction(["userAuth"],"readwrite");n.oncomplete=function(){t()};var o=n.objectStore("userAuth");o.openCursor().onsuccess=function(t){var n=t.target.result;n&&(n.value.username!=e.username&&o.delete(n.value.username),n.continue())},o.put(e)})));case 4:case"end":return n.stop()}}),n)})))()},removeUser:function(e){var t=this;return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e&&e.username){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.getDb();case 4:return r=n.sent,n.abrupt("return",new Promise((function(t){var n=r.transaction(["userAuth"],"readwrite");n.oncomplete=function(){t()};var o=n.objectStore("userAuth");o.delete(e.username)})));case 6:case"end":return n.stop()}}),n)})))()},getUser:function(){var e=this;return Object(ce["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDb();case 2:return n=t.sent,t.abrupt("return",new Promise((function(e){var t=n.transaction(["userAuth"],"readwrite");t.oncomplete=function(){e(r)};var r=null,o=t.objectStore("userAuth");o.openCursor().onsuccess=function(e){var t=e.target.result;t&&(r=t.value)}})));case 4:case"end":return t.stop()}}),t)})))()}},be={namespaced:!0,state:{user:{username:"",loggedIn:!1,authenticationToken:"",authorizationToken:""}},mutations:{LOGIN:function(e,t){var n=t.username,r=t.token;e.user.loggedIn=!0,e.user.username=n,e.user.authenticationToken=r},LOGOUT:function(e){e.user.loggedIn=!1,e.user.username="",e.user.authenticationToken="",e.user.authorizationToken=""},SET_AUTHORIZATION:function(e,t){e.user.authorizationToken=t}},actions:{login:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.username,o=t.password,n.abrupt("return",fetch("/api/auth/login",{method:"POST",body:JSON.stringify({username:r,password:o})}).then((function(e){if(!e.ok)throw new Error("Cannot login!");return e.json()})).then((function(t){ge.addUser({username:r,token:t.authentication_token}),e.commit("LOGIN",{username:r,token:t.authentication_token}),e.commit("SET_AUTHORIZATION",t.authorization_token)})).catch((function(t){throw e.dispatch("logout"),t})));case 2:case"end":return n.stop()}}),n)})))()},logout:function(e){return Object(ce["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",ge.removeUser({username:e.getters.currentUser.username}).then((function(){return fetch("/api/auth/logout",{method:"POST",headers:{Authorization:"Bearer "+e.getters.getTokenAuthentication}}).then((function(){e.commit("LOGOUT"),ke.push({name:"Login"})}))})));case 1:case"end":return t.stop()}}),t)})))()},signup:function(e,t){return Object(ce["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.username,o=t.password,n.abrupt("return",fetch("/api/auth/create-user",{method:"POST",body:JSON.stringify({username:r,password:o})}).then((function(e){if(!e.ok)throw new Error("Cannot signup!");return e.json()})).then((function(t){ge.addUser({username:r,token:t.authentication_token}),e.commit("LOGIN",{username:r,token:t.authentication_token}),e.commit("SET_AUTHORIZATION",t.authorization_token)})).catch((function(t){throw e.dispatch("logout"),t})));case 2:case"end":return n.stop()}}),n)})))()},loadUser:function(e){return Object(ce["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:ge.getUser().then((function(t){t&&t!={}&&e.commit("LOGIN",t)}));case 1:case"end":return t.stop()}}),t)})))()},updateAuthorizationIfNeeded:function(e){return Object(ce["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=0,""!==e.getters.getTokenAuthorization&&(r=Object(fe["a"])(e.getters.getTokenAuthorization),n=1e3*r.exp),!(""===e.getters.getTokenAuthorization||Date.now()>n)){t.next=6;break}return t.abrupt("return",fetch("/api/auth/token",{headers:{Authorization:"Bearer "+e.getters.getTokenAuthentication}}).then((function(e){if(!e.ok)throw new Error("Cannot get token!");return e.json()})).then((function(t){e.commit("SET_AUTHORIZATION",t.authorization_token)})).catch((function(t){throw e.dispatch("logout"),t})));case 6:return t.abrupt("return",new Promise((function(e){e([])})));case 7:case"end":return t.stop()}}),t)})))()}},getters:{currentUser:function(e){return e.user},isLoggedIn:function(e){return!!e.user&&e.user.loggedIn},getTokenAuthorization:function(e){return e.user.authorizationToken},getTokenHeader:function(e){return"Bearer "+e.user.authorizationToken},getTokenAuthentication:function(e){return e.user.authenticationToken}}};r["a"].use(c["a"]);var ve=new c["a"].Store({state:{},mutations:{},actions:{},modules:{posts:le,users:pe,auth:be}});r["a"].use(_["a"]);var we=[{path:"/",name:"Posts",component:Q},{path:"/user/:userid",name:"User",component:ie,props:!0,beforeEnter:function(e,t,n){ve.getters["auth/isLoggedIn"]?n():n({name:"Login"})}},{path:"/login",name:"Login",component:ne,beforeEnter:function(e,t,n){ve.getters["auth/isLoggedIn"]?n({name:"Posts"}):n()}}],_e=new _["a"]({mode:"history",base:"",routes:we}),ke=_e;r["a"].config.productionTip=!1,new r["a"]({components:{BaseCard:E},router:ke,store:ve,render:function(e){return e(v)}}).$mount("#app")},"5ab7":function(e,t,n){},7407:function(e,t,n){"use strict";n("a9b1")},"7a42":function(e,t,n){},"7e55":function(e,t,n){},"85ec":function(e,t,n){},"9c32":function(e,t,n){"use strict";n("7a42")},a9b1:function(e,t,n){},db77:function(e,t,n){},df6b:function(e,t,n){"use strict";n("db77")}});
//# sourceMappingURL=app.3d941563.js.map